# ローディングコンポーネントリファクタリング実行計画

## 概要
既存のローディングコンポーネントを削除し、統一されたグローバルローディングシステムに移行します。UIをより洗練されたものにし、進捗表示の不具合を修正します。

## 実行計画

### フェーズ1: 既存コンポーネントの削除と置き換え

#### 1.1 ImportProgressコンポーネントの削除
- [ ] `apps/reader/src/components/ImportProgress.tsx` ファイルを削除
- [ ] `Library.tsx` から ImportProgress の import を削除
- [ ] `Library.tsx` から importProgress state と関連ロジックを削除
- [ ] グローバルローディングシステムに完全移行

#### 1.2 LoadingBookPlaceholderの置き換え
- [ ] `apps/reader/src/components/Book.tsx` から LoadingBookPlaceholder を削除
- [ ] シンプルなスケルトンローディングまたはグローバルローディングで代替

### フェーズ2: 進捗表示の修正

#### 2.1 進捗更新ロジックの修正
- [ ] `Library.tsx` の handleImportOperation で正しく進捗を更新
- [ ] 10%で止まる updateLocalProgress の問題を修正
- [ ] 実際のインポート処理に基づいた段階的な進捗更新を実装

#### 2.2 進捗ステージの定義
```typescript
// インポート処理の進捗ステージ
- 0-20%: ファイル読み込み
- 20-40%: ファイル検証
- 40-60%: サーバーアップロード
- 60-80%: メタデータ処理
- 80-100%: 完了処理
```

### フェーズ3: UIの改善

#### 3.1 GlobalLoadingOverlayのデザイン改善
- [ ] よりモダンなデザインに更新
- [ ] アニメーションの改善
- [ ] ブランドカラーの使用
- [ ] アイコンの追加（オプション）

#### 3.2 UI改善案
```typescript
// 新しいデザイン要素
- グラデーション背景
- より滑らかなプログレスバー
- 進捗パーセンテージ表示
- 推定残り時間（オプション）
- キャンセルボタン（将来的な拡張）
```

### フェーズ4: 統合とテスト

#### 4.1 統合作業
- [ ] すべてのローディング処理がグローバルシステムを使用することを確認
- [ ] TypeScriptエラーの解決（react-dom型定義の追加）
- [ ] 不要なローディング関連コードの削除

#### 4.2 テスト項目
- [ ] 本のインポート時の進捗表示
- [ ] チャット送信時のローディング
- [ ] 複数ファイル同時インポート
- [ ] エラー時の挙動

## 実装順序

1. **ImportProgressの削除と移行**（優先度: 高）
   - 既存の動作を壊さないよう慎重に移行

2. **進捗更新ロジックの修正**（優先度: 高）
   - 10%で止まる問題の解決

3. **UIデザインの改善**（優先度: 中）
   - ユーザー体験の向上

4. **LoadingBookPlaceholderの置き換え**（優先度: 低）
   - 表示の統一性向上

## 注意事項

- 既存の機能を壊さないよう段階的に実装
- 各フェーズ完了後に動作確認
- TypeScriptの型安全性を維持
- エラーハンドリングの適切な実装

## 成功基準

- すべてのローディング処理が統一されたシステムを使用
- 進捗が正しく0-100%まで更新される
- UIがより洗練され、ユーザーフレンドリーになる
- 既存の機能がすべて正常に動作する